<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=428, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <title>群AI Demo2 - 群话题交互</title>
  <style>
    :root {
      /* 背景色 */
      --bg-aio-01: #F0F0F2;
      --bg-nav-aio: rgba(240, 240, 242, 0.90);
      --bg-nav-bottom-aio: rgba(246, 246, 246, 0.90);
      
      /* 文本色 */
      --text-primary: rgba(0, 0, 0, 0.90);
      --text-secondary: rgba(60, 60, 67, 0.56);
      
      /* 边框色 */
      --border-light: rgba(0, 0, 0, 0.05);
      --border-standard: rgba(0, 0, 0, 0.10);
      
      /* 气泡色 */
      --bubble-guest: white;
      --bubble-guest-text-primary: #1A1C1E;
      --bubble-host-top: #0099FF;
      --bubble-host-text-primary: white;
      
      /* 填充色 */
      --fill-light-tertiary: rgba(255, 255, 255, 0.80);
      
      /* 高亮色 */
      --highlight-bg: rgba(0, 153, 255, 0.08);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-aio-01);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      overflow: hidden;
    }
    
    @media screen and (max-width: 480px) {
      body {
        padding: 0;
        background: var(--bg-aio-01);
      }
    }
    
    .phone-container {
      width: 428px;
      height: 926px;
      background: var(--bg-aio-01);
      border-radius: 40px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    @media screen and (max-width: 480px) {
      body {
        padding: 0;
        background: var(--bg-nav-aio);
      }
      
      .phone-container {
        width: 100vw;
        height: 100vh;
        height: 100dvh;
        border-radius: 0;
        box-shadow: none;
      }
      
      .nav-header {
        border-radius: 0 !important;
        width: 100vw !important;
        padding-top: env(safe-area-inset-top, 44px);
        height: calc(77px + env(safe-area-inset-top, 44px)) !important;
      }
      
      .nav-header.collapsed {
        height: calc(44px + env(safe-area-inset-top, 44px)) !important;
      }
      
      .status-bar {
        display: none !important;
      }
      
      .content-wrapper {
        top: calc(77px + env(safe-area-inset-top, 44px)) !important;
      }
      
      .content-wrapper.collapsed {
        top: calc(44px + env(safe-area-inset-top, 44px)) !important;
      }
      
      .bottom-area {
        border-radius: 0 !important;
        width: 100vw !important;
        padding-bottom: env(safe-area-inset-bottom);
      }
    }
    
    /* 导航头部 */
    .nav-header {
      position: absolute;
      top: 0;
      left: 0;
      width: 428px;
      height: 121px;
      background: var(--bg-nav-aio);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border-bottom: 0.5px solid var(--border-light);
      z-index: 100;
      border-radius: 40px 40px 0 0;
      transition: height 0.3s ease;
    }
    
    .nav-header.collapsed {
      height: 88px;
    }
    
    /* 状态栏 */
    .status-bar {
      width: 100%;
      height: 44px;
      position: relative;
    }
    
    .status-bar .time {
      position: absolute;
      left: 58.77px;
      top: 14.94px;
      font-family: 'SF Pro', -apple-system, sans-serif;
      font-size: 17px;
      font-weight: 590;
      color: black;
    }
    
    .status-bar .icons {
      position: absolute;
      right: 0;
      top: 0;
      width: 141px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 20px;
      gap: 5px;
    }
    
    .status-bar .icons img {
      height: 12px;
    }
    
    /* 标题栏 */
    .title-bar {
      width: 100%;
      height: 44px;
      display: flex;
      align-items: center;
      padding: 0 16px;
      position: relative;
    }
    
    .title-bar .back-btn {
      width: 22px;
      height: 24px;
      cursor: pointer;
      margin-left: -5px;
    }
    
    .title-bar .title {
      margin-left: 12px;
      font-size: 17px;
      font-weight: 500;
      color: var(--text-primary);
    }
    
    .title-bar .menu-btn {
      position: absolute;
      right: 16px;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    
    /* Tab 栏 */
    .tab-bar {
      width: 100%;
      height: 33px;
      padding: 0 16px;
      position: relative;
      overflow: hidden;
      transition: height 0.3s ease, opacity 0.3s ease;
    }
    
    .tab-bar.collapsed {
      height: 0;
      opacity: 0;
    }
    
    .tab-scroll {
      width: 358px;
      height: 25px;
      position: relative;
      overflow: hidden;
    }
    
    .tab-item {
      position: absolute;
      top: 0;
      height: 25px;
      padding: 4px 8px;
      border-radius: 6px;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      font-size: 12px;
      font-weight: 400;
      color: #8C8C8C;
      cursor: pointer;
      white-space: nowrap;
      background: rgba(0, 0, 0, 0.04);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      display: flex;
      align-items: center;
    }
    
    /* Tab位置 - 默认状态 */
    .tab-item[data-tab="0"] {
      left: 0px;
      width: 40px;
    }
    
    .tab-item[data-tab="1"] {
      left: 52px;
      width: 52px;
    }
    
    .tab-item[data-tab="2"] {
      left: 116px;
      width: 52px;
    }
    
    /* 群摘要Tab展开时 - 宽度120px，蓝色文字 */
    .tab-item[data-tab="1"].expanded {
      width: 120px;
      color: #214CA5;
    }
    
    /* 群摘要展开后，快应用Tab右移 */
    .tab-item[data-tab="2"].shifted {
      left: 184px;
    }
    
    .tab-item.active {
      color: black;
      font-weight: 500;
    }
    
    /* 展开状态的群摘要Tab保持蓝色 */
    .tab-item[data-tab="1"].expanded.active {
      color: #214CA5;
    }
    
    .tab-item .tab-text {
      display: inline-block;
      white-space: nowrap;
    }
    
    .tab-item .tab-expand-text {
      display: inline-block;
      max-width: 0;
      overflow: hidden;
      white-space: nowrap;
      transition: max-width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .tab-item.expanded .tab-expand-text {
      max-width: 80px;
    }
    
    .tab-more {
      position: absolute;
      left: 180px;
      top: 0.5px;
      width: 24px;
      height: 24px;
      border-radius: 5.54px;
      outline: 0.92px solid var(--border-standard);
      outline-offset: -0.92px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: transparent;
      transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* 群摘要展开后，+按钮右移 */
    .tab-more.shifted {
      left: 248px;
    }
    
    .tab-more img {
      width: 12.92px;
      height: 12.92px;
    }
    
    /* 内容区域 */
    .content-wrapper {
      position: absolute;
      top: 121px;
      left: 0;
      right: 0;
      bottom: 128px;
      overflow: hidden;
      transition: top 0.3s ease;
    }
    
    .content-wrapper.collapsed {
      top: 88px;
    }
    
    /* 快应用页面时内容区域延伸到底部 */
    .content-wrapper.quick-app-mode {
      bottom: 0;
    }
    
    /* 各Tab内容页 */
    .tab-page {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 0;
      -webkit-overflow-scrolling: touch;
      opacity: 0;
      pointer-events: none;
      transform: translateX(100%);
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    /* 聊天页保持原有padding */
    #chatPage {
      padding: 16px 0;
    }
    
    .tab-page.active {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(0);
    }
    
    /* 页面在左侧（已经滑过去的） */
    .tab-page.left {
      transform: translateX(-100%);
    }
    
    .tab-page::-webkit-scrollbar {
      width: 0;
    }
    
    /* 快应用页面特殊样式 */
    #quickAppPage {
      padding: 0;
    }
    
    /* 时间提示 */
    .time-tip {
      text-align: center;
      padding: 4px 0;
      margin-bottom: 4px;
    }
    
    .time-tip span {
      font-size: 12px;
      font-weight: 400;
      color: var(--text-secondary);
    }
    
    /* 消息容器 */
    .message {
      width: 100%;
      padding: 0 12px;
      margin-bottom: 4px;
      display: flex;
    }
    
    .message.guest {
      justify-content: flex-start;
    }
    
    .message.host {
      justify-content: flex-end;
    }
    
    .message-wrapper {
      display: flex;
      max-width: 364px;
    }
    
    .message.host .message-wrapper {
      flex-direction: row-reverse;
    }
    
    /* 头像 */
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 8px;
      overflow: hidden;
    }
    
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* 消息内容 */
    .message-content {
      display: flex;
      flex-direction: column;
      padding: 0 8px;
    }
    
    .message.host .message-content {
      align-items: flex-end;
    }
    
    .nickname {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      margin: 8px 8px 8px 8px;
      line-height: 14px;
    }
    
    /* 气泡 */
    .bubble {
      padding: 9px;
      border-radius: 10px;
      max-width: 308px;
      word-break: break-word;
      margin-bottom: 8px;
    }
    
    .message.guest .bubble {
      background: var(--bubble-guest);
    }
    
    .message.guest .bubble-text {
      font-size: 17px;
      font-weight: 400;
      color: var(--bubble-guest-text-primary);
    }
    
    .message.host .bubble {
      background: var(--bubble-host-top);
    }
    
    .message.host .bubble-text {
      font-size: 17px;
      font-weight: 400;
      color: var(--bubble-host-text-primary);
    }
    
    /* 高亮消息区域包裹 - 全宽蓝色背景 */
    .highlight-wrapper {
      width: 100%;
      background: transparent;
      transition: background 0.3s ease;
    }
    
    /* 当内部有高亮消息时显示蓝色背景 */
    .highlight-wrapper:has(.highlighted) {
      background: rgba(0, 77, 255, 0.06);
    }
    
    .message.highlighted .bubble {
      background: var(--bubble-guest);
    }
    
    .message.highlighted.host .bubble {
      background: var(--bubble-host-top);
    }
    
    .message.highlighted .bubble-text {
      color: var(--bubble-guest-text-primary);
    }
    
    .message.highlighted.host .bubble-text {
      color: var(--bubble-host-text-primary);
    }

    /* 高亮消失动画 */
    .highlight-wrapper.fading {
      transition: background 0.5s ease;
      background: transparent !important;
    }
    
    /* 图片消息 */
    .bubble-image {
      width: 131px;
      height: 210px;
      border-radius: 10px;
      display: block;
      object-fit: cover;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      margin-bottom: 8px;
    }
    
    .bubble-with-image {
      display: flex;
      flex-direction: column;
    }
    
    .bubble-with-image .bubble-text {
      font-size: 17px;
      font-weight: 400;
    }
    
    .bubble-with-image .bubble-image {
      margin-top: 8px;
    }
    
    /* 表情消息 */
    .bubble-emoji {
      width: 46px;
      height: 46px;
      padding: 9px;
      margin-bottom: 8px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .message.guest .bubble-emoji {
      background: var(--bubble-guest);
    }
    
    .message.host .bubble-emoji {
      background: var(--bubble-host-top);
    }
    
    .bubble-emoji img {
      width: 28px;
      height: 28px;
    }
    
    /* 大表情 */
    .sticker {
      width: 54px;
      height: 54px;
      margin-bottom: 8px;
    }
    
    .sticker img {
      width: 100%;
      height: 100%;
    }
    
    /* ========== 群话题/群摘要页面样式 ========== */
    .topic-page-content {
      padding: 0;
    }
    
    /* 第一个话题项 - 高度118px */
    .topic-item:first-child {
      height: 118px;
      margin-top: 16px;
    }
    
    /* 其他话题项 - 高度158px */
    .topic-item:not(:first-child) {
      height: 158px;
    }
    
    .topic-item {
      display: flex;
      position: relative;
      padding: 0 16px;
      margin-bottom: 20px;
    }
    
    .topic-item:last-child {
      margin-bottom: 40px;
    }
    
    /* 时间线 */
    .topic-timeline {
      width: 20px;
      position: relative;
      flex-shrink: 0;
    }
    
    .timeline-dot-icon {
      width: 20px;
      height: 20px;
      display: block;
    }
    
    /* 第一个话题的时间线 - 90px */
    .topic-item:first-child .timeline-line {
      position: absolute;
      left: 10px;
      top: 28px;
      width: 1px;
      height: 90px;
      background: rgba(0, 0, 0, 0.10);
    }
    
    /* 其他话题的时间线 - 130px（包括最后一个） */
    .topic-item:not(:first-child) .timeline-line {
      position: absolute;
      left: 10px;
      top: 28px;
      width: 1px;
      height: 130px;
      background: rgba(0, 0, 0, 0.10);
    }
    
    /* 话题卡片内容 - 距离时间线12px */
    .topic-content {
      flex: 1;
      margin-left: 12px;
    }
    
    .topic-date {
      font-size: 14px;
      font-weight: 400;
      color: var(--text-secondary);
      height: 20px;
      line-height: 20px;
      padding-left: 16px;
    }
    
    .topic-date.generating {
      display: flex;
      align-items: center;
      gap: 4px;
      padding-left: 16px;
    }
    
    .generating-icon {
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .topic-card {
      width: 360px;
      background: var(--fill-light-tertiary);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s ease;
      margin-top: 8px;
    }
    
    /* 第一个话题卡片 - 高度90px，padding: 16px上 24px下 */
    .topic-item:first-child .topic-card {
      height: 90px;
      padding: 16px 16px 24px 16px;
      box-sizing: border-box;
    }
    
    /* 其他话题卡片 - 高度130px，padding: 16px上 44px下 */
    .topic-item:not(:first-child) .topic-card {
      height: 130px;
      padding: 16px 16px 44px 16px;
      box-sizing: border-box;
    }
    
    .topic-card:active {
      transform: scale(0.98);
    }
    
    @media screen and (max-width: 480px) {
      .topic-card {
        width: calc(100vw - 76px);
      }
    }
    
    .topic-card-title {
      font-size: 17px;
      font-weight: 500;
      color: var(--bubble-guest-text-primary);
      line-height: 1;
      margin-bottom: 13px;
    }
    
    .topic-card-desc {
      font-size: 14px;
      font-weight: 400;
      color: var(--bubble-guest-text-primary);
      line-height: 20px;
    }
    
    /* 第一个卡片描述只显示一行 */
    .topic-item:first-child .topic-card-desc {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: clip;
    }
    
    /* 其他卡片描述显示两行 */
    .topic-item:not(:first-child) .topic-card-desc {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    /* 生成中的省略号动画 */
    .loading-dots {
      display: inline;
    }
    
    .loading-dots span {
      animation: dotPulse 1.4s ease-in-out infinite;
      opacity: 0.3;
    }
    
    .loading-dots span:nth-child(1) {
      animation-delay: 0s;
    }
    
    .loading-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .loading-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes dotPulse {
      0%, 60%, 100% {
        opacity: 0.3;
      }
      30% {
        opacity: 1;
      }
    }
    
    /* ========== 快应用页面样式 ========== */
    .quick-app-content {
      padding: 16px;
      padding-bottom: 140px;
    }
    
    .quick-app-grid {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      gap: 20px 48px;
      justify-content: start;
    }
    
    @media screen and (max-width: 480px) {
      .quick-app-grid {
        gap: 20px calc((100vw - 32px - 300px) / 2);
      }
    }
    
    .quick-app-item {
      width: 100px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .quick-app-item:active {
      transform: scale(0.95);
    }
    
    .quick-app-icon {
      width: 100px;
      height: 136px;
      background: rgba(13, 16, 49, 0.04);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
    }
    
    .quick-app-name {
      font-size: 14px;
      font-weight: 400;
      color: var(--text-primary);
      text-align: center;
    }
    
    /* 快应用底部创建按钮 */
    .quick-app-bottom {
      position: fixed;
      bottom: 44px;
      left: 50%;
      transform: translateX(-50%);
      width: 396px;
      height: 64px;
      z-index: 10;
      display: none;
    }
    
    /* 快应用页面激活时显示底部 */
    #quickAppPage.active .quick-app-bottom {
      display: block;
    }
    
    @media screen and (max-width: 480px) {
      .quick-app-bottom {
        width: calc(100% - 32px);
        left: 16px;
        transform: none;
        bottom: calc(44px + env(safe-area-inset-bottom, 0px));
      }
    }
    
    .create-app-btn {
      width: 100%;
      height: 64px;
      background: white;
      border-radius: 12px;
      display: flex;
      align-items: center;
      padding-left: 16px;
      gap: 8px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .create-app-btn:active {
      transform: scale(0.98);
    }
    
    .create-app-btn img {
      width: 24px;
      height: 24px;
    }
    
    .create-app-btn span {
      font-size: 17px;
      font-weight: 400;
      color: var(--text-secondary);
    }
    
    /* 底部区域 */
    .bottom-area {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 128px;
      background: var(--bg-nav-bottom-aio);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      z-index: 100;
      border-radius: 0 0 40px 40px;
    }
    
    /* 输入框 */
    .input-box {
      width: 100%;
      height: 58px;
      padding: 8px 16px;
    }
    
    .input-box img {
      height: 42px;
    }
    
    /* 工具栏 */
    .toolbar {
      width: 100%;
      height: 36px;
      display: flex;
      align-items: center;
      padding: 4px 32px;
      gap: 39.2px;
    }
    
    .toolbar-btn {
      width: 28px;
      height: 28px;
      cursor: pointer;
    }
    
    .toolbar-btn img {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="phone-container">
    <!-- 导航头部 -->
    <div class="nav-header" id="navHeader">
      <div class="status-bar">
        <div class="time">9:00</div>
        <div class="icons">
          <img src="assets/CodeBubbyAssets/94_7438/10.svg" alt="signal">
          <img src="assets/CodeBubbyAssets/94_7438/9.svg" alt="wifi">
          <img src="assets/CodeBubbyAssets/94_7438/8.svg" alt="battery">
        </div>
      </div>
      
      <div class="title-bar">
        <img class="back-btn" src="assets/CodeBubbyAssets/94_7438/11.svg" alt="back">
        <span class="title">雪球设计组 (12)</span>
        <img class="menu-btn" src="assets/CodeBubbyAssets/94_7438/12.svg" alt="menu">
      </div>
      
      <div class="tab-bar" id="tabBar">
        <div class="tab-scroll" id="tabScroll">
          <div class="tab-item active" data-tab="0">
            <span class="tab-text">聊天</span>
          </div>
          <div class="tab-item" data-tab="1" id="summaryTab">
            <span class="tab-text">群摘要</span><span class="tab-expand-text">: 布偶猫反差</span>
          </div>
          <div class="tab-item" data-tab="2" id="quickAppTab">
            <span class="tab-text">快应用</span>
          </div>
          <div class="tab-more" id="addTabBtn">
            <img src="assets/CodeBubbyAssets/94_7438/13.svg" alt="more">
          </div>
        </div>
      </div>
    </div>
    
    <!-- 内容区域 -->
    <div class="content-wrapper" id="contentWrapper">
      <!-- Tab 0: 聊天页 -->
      <div class="tab-page active" id="chatPage" data-tab="0">
        <div class="time-tip"><span>上午 10:23</span></div>
        
        <!-- 消息1: 哈哈哈哈哈哈哈软软糯糯呢 -->
        <div class="message guest" id="firstMessage">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/1.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">哈哈哈哈哈哈哈软软糯糯呢</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/2.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">其实她在想，这个人怎么还不去上班，整天在这烦我哈哈哈哈哈</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/4.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/3.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/5.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">哈哈哈哈哈哈哈哈哈哈哈哈哈</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/6.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="sticker"><img src="assets/CodeBubbyAssets/105_9490/7.svg" alt="sticker"></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/8.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble bubble-with-image">
                <span class="bubble-text">你看这货，刚吐槽完我，转头就把我刚买的猫条叼沙发上啃</span>
                <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/9.png" alt="cat">
              </div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/10.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">布偶猫是不是都这 "两面派" 属性啊？</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/11.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">哈哈哈哈布偶猫的 "绿茶" 属性是刻在 DNA 里的吧！我家那只更绝 </span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/12.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">我加班到半夜，它蹲在门口冲我喵喵叫，看起来委屈得不行，结果我刚把它抱起来，这货直接把爪子搭我肩膀上睡着了，重得跟块小毛毯似的！</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/14.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/13.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/15.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">对对对！它们是不是算准了自己长得好看，就使劲拿捏人啊？</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/16.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">上次我朋友来我家，这猫直接凑过去蹭人家腿，尾巴甩得跟小旗子似的</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/17.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/18.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/19.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">结果朋友一走，它转头就给我一个 "莫挨老子" 的后脑勺。</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/21.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/20.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/22.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="sticker"><img src="assets/CodeBubbyAssets/105_9490/23.svg" alt="sticker"></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/24.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="sticker"><img src="assets/CodeBubbyAssets/105_9490/25.svg" alt="sticker"></div>
            </div>
          </div>
        </div>
        
        <!-- 高亮消息区域 -->
        <div class="highlight-wrapper" id="highlightWrapper">
          <div class="message guest" id="highlightMsg1">
            <div class="message-wrapper">
              <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/26.svg" alt="avatar"></div>
              <div class="message-content">
                <div class="nickname">蛋黄</div>
                <div class="bubble"><span class="bubble-text">布偶猫的颜值是 "免死金牌" 吧！之前吐槽它掉毛掉得沙发上全是 "蒲公英"</span></div>
              </div>
            </div>
          </div>
          
          <div class="message guest" id="highlightMsg2">
            <div class="message-wrapper">
              <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/27.svg" alt="avatar"></div>
              <div class="message-content">
                <div class="nickname">蛋黄</div>
                <div class="bubble"><span class="bubble-text">我妈还说 "掉毛怎么了？我们宝宝掉的毛都是仙女绒毛"</span></div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/28.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">合着我天天粘毛是我活该呗？</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/29.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/30.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/31.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/32.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/33.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">哈哈哈哈哈哈哈哈哈哈哈哈哈</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/35.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="sticker"><img src="assets/CodeBubbyAssets/105_9490/34.svg" alt="sticker"></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/36.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">这猫上次把我妈的毛线球扒得满地都是</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/37.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">我妈一边捡线一边说 "我们宝宝是在帮我拆快递呢"</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/38.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">转头就给我发消息让我给猫买新的逗猫棒 — 你说这是不是 "猫德绑架"？</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/39.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/40.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/41.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/42.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/43.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">哈哈哈哈哈哈哈哈哈哈哈哈哈</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/44.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">我懂！我家那只把我杯子碰倒了，水洒了一桌子，它蹲在旁边舔爪子，我刚想凶它，它突然用脑袋蹭我手，我瞬间就软了 — 布偶猫这 "美貌 + 软萌" 的组合，是不是专门用来让人放弃原则的啊？</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/46.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/45.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/48.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/105_9490/47.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/105_9490/49.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="sticker"><img src="assets/CodeBubbyAssets/105_9490/50.svg" alt="sticker"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tab 1: 群话题/群摘要页 -->
      <div class="tab-page" id="topicPage" data-tab="1">
        <div class="topic-page-content">
          <!-- 话题1: 生成中 -->
          <div class="topic-item">
            <div class="topic-timeline">
              <img src="assets/CodeBubbyAssets/98_12581/9.svg" alt="dot" class="timeline-dot-icon">
              <div class="timeline-line"></div>
            </div>
            <div class="topic-content">
              <div class="topic-date generating">
                <img src="assets/CodeBubbyAssets/98_12581/8.svg" alt="loading" class="generating-icon">
                <span>生成中</span>
              </div>
              <div class="topic-card" id="topicCard1">
                <div class="topic-card-title">布偶猫反差</div>
                <div class="topic-card-desc">布偶猫对外粘人撒娇，转头就给主人甩冷脸<span class="loading-dots"><span>.</span><span>.</span><span>.</span></span></div>
              </div>
            </div>
          </div>
          
          <!-- 话题2: 布偶猫的颜值免罚权 -->
          <div class="topic-item">
            <div class="topic-timeline">
              <img src="assets/CodeBubbyAssets/98_12581/9.svg" alt="dot" class="timeline-dot-icon">
              <div class="timeline-line"></div>
            </div>
            <div class="topic-content">
              <div class="topic-date">12-24 </div>
              <div class="topic-card" id="topicCard2" data-action="highlight">
                <div class="topic-card-title">布偶猫的颜值免罚权</div>
                <div class="topic-card-desc">布偶猫闯祸时，家人会帮它找借口。主人一边吐槽它掉毛拆家，一边被它的颜值软化，自愿妥协。</div>
              </div>
            </div>
          </div>
          
          <!-- 话题3 -->
          <div class="topic-item">
            <div class="topic-timeline">
              <img src="assets/CodeBubbyAssets/98_12581/9.svg" alt="dot" class="timeline-dot-icon">
              <div class="timeline-line"></div>
            </div>
            <div class="topic-content">
              <div class="topic-date">12-22</div>
              <div class="topic-card" id="topicCard3">
                <div class="topic-card-title">养布偶猫：痛并快乐着</div>
                <div class="topic-card-desc">布偶猫粘人时能治愈疲惫，生病时会安静陪伴。主人虽抱怨挑食，仍主动买冻干讨好，甘愿当猫奴。</div>
              </div>
            </div>
          </div>
          
          <!-- 话题4 -->
          <div class="topic-item">
            <div class="topic-timeline">
              <img src="assets/CodeBubbyAssets/98_12581/9.svg" alt="dot" class="timeline-dot-icon">
              <div class="timeline-line"></div>
            </div>
            <div class="topic-content">
              <div class="topic-date">12-21 </div>
              <div class="topic-card" id="topicCard4">
                <div class="topic-card-title">布偶猫的反差技能</div>
                <div class="topic-card-desc">布偶猫会抓坏窗帘搞破坏，也会化身暖乎乎的小毛毯。它用调皮和温柔，让主人又气又爱。</div>
              </div>
            </div>
          </div>
          
          <!-- 话题5 -->
          <div class="topic-item">
            <div class="topic-timeline">
              <img src="assets/CodeBubbyAssets/98_12581/9.svg" alt="dot" class="timeline-dot-icon">
              <div class="timeline-line"></div>
            </div>
            <div class="topic-content">
              <div class="topic-date">12-21 </div>
              <div class="topic-card" id="topicCard5">
                <div class="topic-card-title">布偶猫的专属拿捏术</div>
                <div class="topic-card-desc">布偶猫懂得用蹭手、踩奶示好。主人刚吐槽完它，转眼就被这些小动作收服。</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tab 2: 快应用页 -->
      <div class="tab-page" id="quickAppPage" data-tab="2">
        <div class="quick-app-content">
          <div class="quick-app-grid">
            <div class="quick-app-item">
              <div class="quick-app-icon"></div>
              <div class="quick-app-name">投票</div>
            </div>
            <div class="quick-app-item">
              <div class="quick-app-icon"></div>
              <div class="quick-app-name">中午吃什么</div>
            </div>
            <div class="quick-app-item">
              <div class="quick-app-icon"></div>
              <div class="quick-app-name">班级点名</div>
            </div>
            <div class="quick-app-item">
              <div class="quick-app-icon"></div>
              <div class="quick-app-name">班级接龙</div>
            </div>
            <div class="quick-app-item">
              <div class="quick-app-icon"></div>
              <div class="quick-app-name">各类书面申请</div>
            </div>
          </div>
        </div>
        <div class="quick-app-bottom">
          <div class="create-app-btn">
            <img src="assets/CodeBubbyAssets/110_9480/7.svg" alt="create">
            <span>输入文字来创建新的快应用</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 底部区域 -->
    <div class="bottom-area">
      <div class="input-box">
        <img src="assets/CodeBubbyAssets/94_7438/1.svg" alt="input">
      </div>
      <div class="toolbar">
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/94_7438/2.svg" alt="voice"></div>
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/94_7438/3.svg" alt="emoji"></div>
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/94_7438/4.svg" alt="image"></div>
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/94_7438/5.svg" alt="plus"></div>
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/94_7438/6.svg" alt="red-packet"></div>
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/94_7438/7.svg" alt="more"></div>
      </div>
    </div>
  </div>
  
  <script>
    // ========== 状态管理 ==========
    let currentTabIndex = 0;
    let summaryExpandTimer = null;
    let summaryCollapseTimer = null;
    let isSummaryExpanded = false;
    let hasSummaryExpandedOnce = false; // 是否已经展开过一次
    let chatPageStayTimer = null;
    let isHeaderCollapsed = false;
    let lastScrollTop = 0;
    let autoExpandTimer = null;
    
    // DOM 元素
    const tabs = document.querySelectorAll('.tab-item');
    const tabPages = document.querySelectorAll('.tab-page');
    const summaryTab = document.getElementById('summaryTab');
    const tabScroll = document.getElementById('tabScroll');
    const chatPage = document.getElementById('chatPage');
    const topicPage = document.getElementById('topicPage');
    const quickAppPage = document.getElementById('quickAppPage');
    const addTabBtn = document.getElementById('addTabBtn');
    const highlightWrapper = document.getElementById('highlightWrapper');
    const highlightMsg1 = document.getElementById('highlightMsg1');
    const highlightMsg2 = document.getElementById('highlightMsg2');
    const firstMessage = document.getElementById('firstMessage');
    const topicCard2 = document.getElementById('topicCard2');
    const bottomArea = document.querySelector('.bottom-area');
    const contentWrapper = document.getElementById('contentWrapper');
    const navHeader = document.querySelector('.nav-header');
    const tabBar = document.querySelector('.tab-bar');
    const quickAppTab = document.getElementById('quickAppTab');
    
    // ========== 页面加载 ==========
    document.addEventListener('DOMContentLoaded', function() {
      // 滚动到底部
      chatPage.scrollTop = chatPage.scrollHeight;
      
      // 开始聊天页停留计时
      startChatPageStayTimer();
    });
    
    // ========== Tab 切换功能 ==========
    function switchToTab(index, options = {}) {
      if (index < 0 || index >= tabs.length) return;
      
      const previousIndex = currentTabIndex;
      currentTabIndex = index;
      
      // 更新 Tab 样式
      tabs.forEach((t, i) => {
        t.classList.toggle('active', i === index);
      });
      
      // 更新页面显示（横滑动效）
      tabPages.forEach(page => {
        const pageIndex = parseInt(page.dataset.tab);
        page.classList.remove('active', 'left');
        
        if (pageIndex === index) {
          page.classList.add('active');
        } else if (pageIndex < index) {
          // 在当前页左边的页面
          page.classList.add('left');
        }
        // pageIndex > index 的页面保持默认的 translateX(100%)
      });
      
      // 控制底部区域显示（群摘要页和快应用页面隐藏默认底部，内容区域延伸到底部）
      if (index === 1 || index === 2) {
        bottomArea.style.display = 'none';
        contentWrapper.classList.add('quick-app-mode');
      } else {
        bottomArea.style.display = 'block';
        contentWrapper.classList.remove('quick-app-mode');
      }
      
      // 切换Tab时展开顶部栏并重置滚动状态
      expandHeader();
      clearAutoExpandTimer();
      lastScrollTop = 0;
      
      // 切换到聊天页时的处理
      if (index === 0) {
        // 如果是从话题页带高亮跳转过来
        if (options.scrollToHighlight) {
          scrollToHighlightMessages();
        }
        // 如果是点击+按钮
        else if (options.scrollToFirst) {
          scrollToFirstMessage();
        }
        
        // 开始停留计时（只有未展开过才会计时）
        startChatPageStayTimer();
      } else {
        // 离开聊天页，停止计时
        stopChatPageStayTimer();
        
        // 如果群摘要Tab已展开，收起它
        if (isSummaryExpanded) {
          collapseSummaryTab();
        }
      }
      
      // 切换到群话题页时，滚动到顶部
      if (index === 1) {
        topicPage.scrollTop = 0;
      }
    }
    
    // Tab 点击事件（支持触摸和点击）
    tabs.forEach((tab, index) => {
      let touchMoved = false;
      
      tab.addEventListener('touchstart', function(e) {
        touchMoved = false;
      }, { passive: true });
      
      tab.addEventListener('touchmove', function(e) {
        touchMoved = true;
      }, { passive: true });
      
      tab.addEventListener('touchend', function(e) {
        if (!touchMoved) {
          e.preventDefault();
          switchToTab(index);
        }
      });
      
      tab.addEventListener('click', function(e) {
        // 桌面端点击
        if (!('ontouchstart' in window)) {
          switchToTab(index);
        }
      });
    });
    
    // ========== 群摘要Tab展开/收起动画 ==========
    function expandSummaryTab() {
      if (isSummaryExpanded || hasSummaryExpandedOnce) return;
      
      isSummaryExpanded = true;
      hasSummaryExpandedOnce = true; // 标记已展开过一次
      summaryTab.classList.add('expanded');
      quickAppTab.classList.add('shifted');
      addTabBtn.classList.add('shifted');
      
      // 6秒后如果没有点击，自动收起
      summaryCollapseTimer = setTimeout(() => {
        if (isSummaryExpanded && currentTabIndex === 0) {
          collapseSummaryTab();
        }
      }, 6000);
    }
    
    function collapseSummaryTab() {
      if (!isSummaryExpanded) return;
      
      isSummaryExpanded = false;
      summaryTab.classList.remove('expanded');
      quickAppTab.classList.remove('shifted');
      addTabBtn.classList.remove('shifted');
      
      if (summaryCollapseTimer) {
        clearTimeout(summaryCollapseTimer);
        summaryCollapseTimer = null;
      }
      
      // 只展开一次，不再循环
    }
    
    // ========== 聊天页停留计时 ==========
    function startChatPageStayTimer() {
      // 如果已经展开过一次，不再计时
      if (hasSummaryExpandedOnce) return;
      
      stopChatPageStayTimer();
      
      // 2秒后展开
      chatPageStayTimer = setTimeout(() => {
        if (currentTabIndex === 0) {
          expandSummaryTab();
        }
      }, 2000);
    }
    
    function stopChatPageStayTimer() {
      if (chatPageStayTimer) {
        clearTimeout(chatPageStayTimer);
        chatPageStayTimer = null;
      }
    }
    
    // 重置群摘要展开状态（点击+按钮时调用）
    function resetSummaryExpandState() {
      hasSummaryExpandedOnce = false;
      if (isSummaryExpanded) {
        collapseSummaryTab();
      }
      stopChatPageStayTimer();
      // 重新开始计时
      if (currentTabIndex === 0) {
        startChatPageStayTimer();
      }
    }
    
    // ========== 话题高亮功能 ==========
    let isScrollingToHighlight = false; // 标记是否正在滚动到高亮位置
    
    function scrollToHighlightMessages() {
      // 标记正在滚动到高亮位置，暂时禁用滚动收折
      isScrollingToHighlight = true;
      
      // 添加高亮样式 - 给包裹容器添加背景色
      highlightMsg1.classList.add('highlighted');
      highlightMsg2.classList.add('highlighted');
      
      // 滚动到高亮消息位置 - 让高亮消息显示在顶部（作为第一条可见消息）
      setTimeout(() => {
        highlightWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // 滚动完成后更新 lastScrollTop 并恢复滚动收折功能
        setTimeout(() => {
          lastScrollTop = chatPage.scrollTop;
          isScrollingToHighlight = false;
        }, 500);
      }, 100);
      
      // 监听滚动，滚动后移除高亮
      let scrollHandler = null;
      let hasScrolled = false;
      
      scrollHandler = function() {
        if (!hasScrolled) {
          hasScrolled = true;
          
          // 延迟一点再移除高亮，让用户看到
          setTimeout(() => {
            highlightWrapper.classList.add('fading');
            
            setTimeout(() => {
              highlightMsg1.classList.remove('highlighted');
              highlightMsg2.classList.remove('highlighted');
              highlightWrapper.classList.remove('fading');
            }, 500);
          }, 500);
          
          chatPage.removeEventListener('scroll', scrollHandler);
        }
      };
      
      // 等待滚动完成后再添加监听
      setTimeout(() => {
        chatPage.addEventListener('scroll', scrollHandler);
      }, 1000);
    }
    
    function scrollToFirstMessage() {
      chatPage.scrollTop = 0;
    }
    
    // ========== 话题卡片点击 ==========
    const topicCard3 = document.getElementById('topicCard3');
    const topicCard4 = document.getElementById('topicCard4');
    const topicCard5 = document.getElementById('topicCard5');
    
    topicCard2.addEventListener('click', function() {
      switchToTab(0, { scrollToHighlight: true });
    });
    
    topicCard3.addEventListener('click', function() {
      switchToTab(0, { scrollToHighlight: true });
    });
    
    topicCard4.addEventListener('click', function() {
      switchToTab(0, { scrollToHighlight: true });
    });
    
    topicCard5.addEventListener('click', function() {
      switchToTab(0, { scrollToHighlight: true });
    });
    
    // ========== + 按钮点击 ==========
    addTabBtn.addEventListener('click', function() {
      // 重置群摘要展开状态，重新开始计时
      resetSummaryExpandState();
      switchToTab(0, { scrollToFirst: true });
    });
    
    // ========== 左滑切换 Tab ==========
    let touchStartX = 0;
    let touchStartY = 0;
    let isSwiping = false;
    
    document.querySelectorAll('.tab-page').forEach(page => {
      page.addEventListener('touchstart', function(e) {
        if (e.touches.length === 1) {
          touchStartX = e.touches[0].clientX;
          touchStartY = e.touches[0].clientY;
          isSwiping = true;
        }
      }, { passive: true });
      
      page.addEventListener('touchmove', function(e) {
        if (!isSwiping || e.touches.length !== 1) return;
        
        const touchCurrentX = e.touches[0].clientX;
        const touchCurrentY = e.touches[0].clientY;
        const deltaX = touchCurrentX - touchStartX;
        const deltaY = touchCurrentY - touchStartY;
        
        // 如果垂直滑动大于水平滑动，取消切换
        if (Math.abs(deltaY) > Math.abs(deltaX)) {
          isSwiping = false;
        }
      }, { passive: true });
      
      page.addEventListener('touchend', function(e) {
        if (!isSwiping) return;
        isSwiping = false;
        
        const touchEndX = e.changedTouches[0].clientX;
        const deltaX = touchEndX - touchStartX;
        const threshold = 80;
        
        if (deltaX < -threshold && currentTabIndex < tabs.length - 1) {
          // 左滑，切换到下一个Tab
          switchToTab(currentTabIndex + 1);
        } else if (deltaX > threshold && currentTabIndex > 0) {
          // 右滑，切换到上一个Tab
          switchToTab(currentTabIndex - 1);
        }
      }, { passive: true });
    });
    
    // ========== 群摘要Tab点击处理 ==========
    summaryTab.addEventListener('click', function(e) {
      // 清除自动收起计时器
      if (summaryCollapseTimer) {
        clearTimeout(summaryCollapseTimer);
        summaryCollapseTimer = null;
      }
      
      // 收起展开状态
      if (isSummaryExpanded) {
        collapseSummaryTab();
      }
      
      // 切换到群话题页
      switchToTab(1);
    });
    
    // ========== 顶部Tab栏收折功能 ==========
    function collapseHeader() {
      if (isHeaderCollapsed) return;
      isHeaderCollapsed = true;
      navHeader.classList.add('collapsed');
      tabBar.classList.add('collapsed');
      contentWrapper.classList.add('collapsed');
    }
    
    function expandHeader() {
      if (!isHeaderCollapsed) return;
      isHeaderCollapsed = false;
      navHeader.classList.remove('collapsed');
      tabBar.classList.remove('collapsed');
      contentWrapper.classList.remove('collapsed');
    }
    
    function handleScroll(scrollArea) {
      // 如果正在滚动到高亮位置，不触发收折
      if (isScrollingToHighlight) return;
      
      const currentScrollTop = scrollArea.scrollTop;
      const scrollDelta = currentScrollTop - lastScrollTop;
      
      if (scrollDelta > 10 && !isHeaderCollapsed && currentScrollTop > 50) {
        collapseHeader();
        // 群摘要和快应用页面：收折后开始2秒计时
        if (currentTabIndex === 1 || currentTabIndex === 2) {
          startAutoExpandTimer();
        }
      } else if (scrollDelta < -10 && isHeaderCollapsed) {
        expandHeader();
        // 清除自动展开计时器
        clearAutoExpandTimer();
      }
      
      lastScrollTop = currentScrollTop;
    }
    
    // 群摘要和快应用页面：2秒无操作后自动展开Tab栏
    function startAutoExpandTimer() {
      clearAutoExpandTimer();
      autoExpandTimer = setTimeout(() => {
        if ((currentTabIndex === 1 || currentTabIndex === 2) && isHeaderCollapsed) {
          expandHeader();
        }
      }, 2000);
    }
    
    function clearAutoExpandTimer() {
      if (autoExpandTimer) {
        clearTimeout(autoExpandTimer);
        autoExpandTimer = null;
      }
    }
    
    // 为所有Tab页面添加滚动监听
    chatPage.addEventListener('scroll', function() {
      if (currentTabIndex === 0) {
        handleScroll(chatPage);
      }
    }, { passive: true });
    
    topicPage.addEventListener('scroll', function() {
      if (currentTabIndex === 1) {
        handleScroll(topicPage);
        // 任何滚动操作都重置计时器
        if (isHeaderCollapsed) {
          startAutoExpandTimer();
        }
      }
    }, { passive: true });
    
    quickAppPage.addEventListener('scroll', function() {
      if (currentTabIndex === 2) {
        handleScroll(quickAppPage);
        // 任何滚动操作都重置计时器
        if (isHeaderCollapsed) {
          startAutoExpandTimer();
        }
      }
    }, { passive: true });
    
    // 群摘要和快应用页面：触摸操作重置计时器
    topicPage.addEventListener('touchstart', function() {
      if (currentTabIndex === 1 && isHeaderCollapsed) {
        clearAutoExpandTimer();
      }
    }, { passive: true });
    
    topicPage.addEventListener('touchend', function() {
      if (currentTabIndex === 1 && isHeaderCollapsed) {
        startAutoExpandTimer();
      }
    }, { passive: true });
    
    quickAppPage.addEventListener('touchstart', function() {
      if (currentTabIndex === 2 && isHeaderCollapsed) {
        clearAutoExpandTimer();
      }
    }, { passive: true });
    
    quickAppPage.addEventListener('touchend', function() {
      if (currentTabIndex === 2 && isHeaderCollapsed) {
        startAutoExpandTimer();
      }
    }, { passive: true });
  </script>
</body>
</html>
