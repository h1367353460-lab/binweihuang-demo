<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=428, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <title>雪球设计组 - 整合-生成中</title>
  <style>
    :root {
      /* 背景色 */
      --bg-aio-01: #F0F0F2;
      --bg-nav-aio: rgba(240, 240, 242, 0.90);
      --bg-nav-bottom-aio: rgba(246, 246, 246, 0.90);
      
      /* 文本色 */
      --text-primary: rgba(0, 0, 0, 0.90);
      --text-secondary: rgba(60, 60, 67, 0.56);
      
      /* 边框色 */
      --border-light: rgba(0, 0, 0, 0.05);
      --border-standard: rgba(0, 0, 0, 0.10);
      
      /* 气泡色 */
      --bubble-guest: white;
      --bubble-guest-text-primary: #1A1C1E;
      --bubble-host-top: #0099FF;
      --bubble-host-text-primary: white;
      
      /* 填充色 */
      --fill-light-tertiary: rgba(255, 255, 255, 0.80);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-aio-01);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      overflow: hidden;
    }
    
    @media screen and (max-width: 480px) {
      body {
        padding: 0;
        background: var(--bg-aio-01);
      }
    }
    
    .phone-container {
      width: 428px;
      height: 926px;
      background: var(--bg-aio-01);
      border-radius: 40px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transition: background-color 0.4s ease;
    }
    
    /* Tab 背景色主题 */
    .phone-container.theme-tab1 { background: #F0F0F2; }
    .phone-container.theme-tab2 { background: #E8F4F8; }
    .phone-container.theme-tab3 { background: #F0F8E8; }
    .phone-container.theme-tab4 { background: #FFF8E8; }
    .phone-container.theme-tab5 { background: #F8E8F4; }
    
    @media screen and (max-width: 480px) {
      body {
        padding: 0;
        background: var(--bg-nav-aio);
      }
      
      .phone-container {
        width: 100vw;
        height: 100vh;
        height: 100dvh;
        border-radius: 0;
        box-shadow: none;
      }
      
      .nav-header {
        border-radius: 0 !important;
        width: 100vw !important;
        /* 向上延伸覆盖系统状态栏区域 */
        padding-top: env(safe-area-inset-top, 44px);
        /* 77px = 44px(标题栏) + 33px(tab栏) */
        height: calc(77px + env(safe-area-inset-top, 44px)) !important;
      }
      
      .nav-header.collapsed {
        /* 44px = 标题栏高度 */
        height: calc(44px + env(safe-area-inset-top, 44px)) !important;
      }
      
      /* 隐藏页面内状态栏 */
      .status-bar {
        display: none !important;
      }
      
      /* 调整内容区域位置 */
      .transition-wrapper {
        top: calc(44px + env(safe-area-inset-top, 44px)) !important;
      }
      
      .transition-wrapper.with-tab {
        top: calc(77px + env(safe-area-inset-top, 44px)) !important;
      }
      
      .bottom-area {
        border-radius: 0 !important;
        width: 100vw !important;
        padding-bottom: env(safe-area-inset-bottom);
      }
    }
    
    /* iOS PWA 全屏模式适配 - 添加到主屏幕后 */
    @media screen and (display-mode: standalone) {
      .phone-container {
        width: 100vw;
        height: 100vh;
        height: 100dvh;
        border-radius: 0;
        box-shadow: none;
      }
      
      .nav-header {
        border-radius: 0 !important;
        width: 100vw !important;
        padding-top: env(safe-area-inset-top);
        /* 77px = 44px(标题栏) + 33px(tab栏) */
        height: calc(77px + env(safe-area-inset-top)) !important;
      }
      
      .nav-header.collapsed {
        /* 44px = 标题栏高度 */
        height: calc(44px + env(safe-area-inset-top)) !important;
      }
      
      /* 隐藏页面内状态栏，让系统状态栏显示 */
      .status-bar {
        display: none !important;
      }
      
      .transition-wrapper {
        top: calc(44px + env(safe-area-inset-top)) !important;
      }
      
      .transition-wrapper.with-tab {
        top: calc(77px + env(safe-area-inset-top)) !important;
      }
      
      .bottom-area {
        border-radius: 0 !important;
        width: 100vw !important;
        padding-bottom: env(safe-area-inset-bottom);
      }
    }
    
    /* 导航头部 */
    .nav-header {
      position: absolute;
      top: 0;
      left: 0;
      width: 428px;
      height: 121px;
      background: var(--bg-nav-aio);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border-bottom: 0.5px solid var(--border-light);
      z-index: 100;
      border-radius: 40px 40px 0 0;
      transition: height 0.3s ease;
    }
    
    .nav-header.collapsed {
      height: 88px;
    }
    
    /* 状态栏 */
    .status-bar {
      width: 100%;
      height: 44px;
      position: relative;
    }
    
    .status-bar .time {
      position: absolute;
      left: 58.77px;
      top: 14.94px;
      font-family: 'SF Pro', -apple-system, sans-serif;
      font-size: 17px;
      font-weight: 590;
      color: black;
    }
    
    .status-bar .icons {
      position: absolute;
      right: 0;
      top: 0;
      width: 141px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 20px;
      gap: 5px;
    }
    
    .status-bar .icons img {
      height: 12px;
    }
    
    /* 标题栏 */
    .title-bar {
      width: 100%;
      height: 44px;
      display: flex;
      align-items: center;
      padding: 0 16px;
      position: relative;
    }
    
    .title-bar .back-btn {
      width: 22px;
      height: 24px;
      cursor: pointer;
      margin-left: -5px;
    }
    
    .title-bar .title {
      margin-left: 12px;
      font-size: 17px;
      font-weight: 500;
      color: var(--text-primary);
    }
    
    .title-bar .menu-btn {
      position: absolute;
      right: 16px;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    
    /* Tab 栏 */
    .tab-bar {
      width: 100%;
      height: 33px;
      display: flex;
      align-items: center;
      padding: 0 16px;
      position: relative;
      overflow: hidden;
      transition: height 0.3s ease, opacity 0.3s ease;
    }
    
    .tab-bar.collapsed {
      height: 0;
      opacity: 0;
    }
    
    .tab-scroll {
      width: 287px;
      overflow-x: auto;
      display: flex;
      gap: 12px;
      scrollbar-width: none;
    }
    
    .tab-scroll::-webkit-scrollbar {
      display: none;
    }
    
    .tab-item {
      flex-shrink: 0;
      height: 25px;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      font-weight: 400;
      color: #8C8C8C;
      cursor: pointer;
      white-space: nowrap;
      background: rgba(0, 0, 0, 0.04);
    }
    
    .tab-item.active {
      color: black;
      font-weight: 600;
    }
    
    .tab-more {
      margin-left: 16px;
      width: 24px;
      height: 24px;
      border-radius: 5.54px;
      border: 0.92px solid var(--border-standard);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    /* 内容过渡容器 */
    .transition-wrapper {
      position: absolute;
      top: 88px;
      left: 0;
      right: 0;
      bottom: 128px;
      overflow: hidden;
      transform-origin: center center;
    }
    
    .transition-wrapper.with-tab {
      top: 121px;
    }
    
    .transition-wrapper.pinching {
      transition: none;
    }
    
    .transition-wrapper.expanding {
      transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .transition-wrapper.collapsing {
      transition: transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    
    /* 消息区域 */
    .message-area {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 16px 0;
      -webkit-overflow-scrolling: touch;
      transition: opacity 0.15s ease, transform 0.3s ease;
    }
    
    .message-area.fading {
      opacity: 0;
    }
    
    /* 横滑切换动画 */
    .message-area.slide-out-left {
      transform: translateX(-30%);
      opacity: 0;
    }
    
    .message-area.slide-out-right {
      transform: translateX(30%);
      opacity: 0;
    }
    
    .message-area.slide-in-left {
      transform: translateX(-30%);
      opacity: 0;
      transition: none !important;
    }
    
    .message-area.slide-in-right {
      transform: translateX(30%);
      opacity: 0;
      transition: none !important;
    }
    
    .message-area::-webkit-scrollbar {
      width: 0;
    }
    
    /* AI 总结内容区域 */
    .content-area {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 16px;
      -webkit-overflow-scrolling: touch;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease;
    }
    
    .content-area.visible {
      opacity: 1;
      pointer-events: auto;
    }
    
    .content-area::-webkit-scrollbar {
      width: 0;
    }
    
    /* 时间提示 */
    .time-tip {
      text-align: center;
      padding: 4px 0;
      margin-bottom: 4px;
    }
    
    .time-tip span {
      font-size: 12px;
      font-weight: 400;
      color: var(--text-secondary);
    }
    
    /* 消息容器 */
    .message {
      width: 100%;
      padding: 0 12px;
      margin-bottom: 4px;
      display: flex;
    }
    
    .message.guest {
      justify-content: flex-start;
    }
    
    .message.host {
      justify-content: flex-end;
    }
    
    .message-wrapper {
      display: flex;
      max-width: 364px;
    }
    
    .message.host .message-wrapper {
      flex-direction: row-reverse;
    }
    
    /* 头像 */
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 8px;
      overflow: hidden;
    }
    
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* 消息内容 */
    .message-content {
      display: flex;
      flex-direction: column;
      padding: 0 8px;
    }
    
    .message.host .message-content {
      align-items: flex-end;
    }
    
    .nickname {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      margin: 8px 8px 8px 8px;
      line-height: 14px;
    }
    
    /* 气泡 */
    .bubble {
      padding: 9px;
      border-radius: 10px;
      max-width: 308px;
      word-break: break-word;
      margin-bottom: 8px;
    }
    
    .message.guest .bubble {
      background: var(--bubble-guest);
    }
    
    .message.guest .bubble-text {
      font-size: 17px;
      font-weight: 400;
      color: var(--bubble-guest-text-primary);
    }
    
    .message.host .bubble {
      background: var(--bubble-host-top);
    }
    
    .message.host .bubble-text {
      font-size: 17px;
      font-weight: 400;
      color: var(--bubble-host-text-primary);
    }
    
    /* 图片消息 */
    .bubble-image {
      width: 131px;
      height: 210px;
      border-radius: 10px;
      display: block;
      object-fit: cover;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      margin-bottom: 8px;
    }
    
    .bubble-with-image {
      display: flex;
      flex-direction: column;
    }
    
    .bubble-with-image .bubble-text {
      font-size: 17px;
      font-weight: 400;
    }
    
    .bubble-with-image .bubble-image {
      margin-top: 8px;
    }
    
    /* 表情消息 */
    .bubble-emoji {
      width: 46px;
      height: 46px;
      padding: 9px;
      margin-bottom: 8px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .message.guest .bubble-emoji {
      background: var(--bubble-guest);
    }
    
    .message.host .bubble-emoji {
      background: var(--bubble-host-top);
    }
    
    .bubble-emoji img {
      width: 28px;
      height: 28px;
    }
    
    /* 大表情 */
    .sticker {
      width: 54px;
      height: 54px;
      margin-bottom: 8px;
    }
    
    .sticker img {
      width: 100%;
      height: 100%;
    }
    
    /* 高亮消息区域包裹 - 全宽蓝色背景 */
    .highlight-wrapper {
      width: 100%;
      background: transparent;
      transition: background 0.3s ease;
    }
    
    /* 当内部有高亮消息时显示蓝色背景 */
    .highlight-wrapper:has(.highlighted) {
      background: rgba(0, 77, 255, 0.06);
    }
    
    /* 高亮消失动画 */
    .highlight-wrapper.fading {
      transition: background 0.5s ease;
      background: transparent !important;
    }
    
    /* AI 总结卡片 */
    .summary-card {
      width: 396px;
      height: 153px;
      background: var(--fill-light-tertiary);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 20px;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .summary-card:not(.generating):active {
      transform: scale(0.98);
    }
    
    @media screen and (max-width: 480px) {
      .summary-card {
        width: calc(100vw - 32px);
      }
    }
    
    .summary-card-content {
      position: absolute;
      left: 20px;
      top: 12px;
      width: 356px;
    }
    
    .summary-date {
      font-size: 12px;
      font-weight: 400;
      color: var(--text-secondary);
      line-height: 1;
      margin-bottom: 9px;
    }
    
    .summary-text {
      font-size: 14px;
      font-weight: 400;
      color: var(--bubble-guest-text-primary);
      line-height: 20px;
    }
    
    /* 生成中卡片样式 */
    .summary-card.generating .summary-date {
      margin-bottom: 9px;
    }
    
    .summary-card.generating .summary-text {
      line-height: 20px;
    }
    
    /* 头像组 */
    .avatar-group {
      position: absolute;
      top: 97px;
      display: flex;
      align-items: flex-end;
    }
    
    .avatar-group.three-avatars {
      left: 126px;
      width: 144.88px;
      height: 71.01px;
    }
    
    .avatar-group.three-avatars .avatar-item {
      position: absolute;
    }
    
    .avatar-group.three-avatars .avatar-item:nth-child(1) {
      left: 0;
      top: 12.9px;
    }
    
    .avatar-group.three-avatars .avatar-item:nth-child(1) img {
      width: 49px;
      height: 49px;
      transform: rotate(-12deg);
    }
    
    .avatar-group.three-avatars .avatar-item:nth-child(2) {
      left: 41px;
      top: 15.03px;
    }
    
    .avatar-group.three-avatars .avatar-item:nth-child(2) img {
      width: 49px;
      height: 49px;
      transform: rotate(-6deg);
    }
    
    .avatar-group.three-avatars .avatar-item:nth-child(3) {
      left: 77.87px;
      top: 0;
    }
    
    .avatar-group.three-avatars .avatar-item:nth-child(3) img {
      width: 56.5px;
      height: 56.5px;
      transform: rotate(12deg);
    }
    
    .avatar-group.three-avatars .avatar-item img {
      border-radius: 12px;
      object-fit: cover;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
      image-rendering: -webkit-optimize-contrast;
    }
    
    .avatar-group.four-avatars {
      left: 111px;
      width: 173.88px;
      height: 83.61px;
    }
    
    .avatar-group.four-avatars .avatar-item {
      position: absolute;
    }
    
    .avatar-group.four-avatars .avatar-item:nth-child(1) {
      left: 0;
      top: 23px;
    }
    
    .avatar-group.four-avatars .avatar-item:nth-child(1) img {
      width: 49px;
      height: 49px;
      transform: rotate(-16deg);
    }
    
    .avatar-group.four-avatars .avatar-item:nth-child(2) {
      left: 29px;
      top: 12.9px;
    }
    
    .avatar-group.four-avatars .avatar-item:nth-child(2) img {
      width: 49px;
      height: 49px;
      transform: rotate(-12deg);
    }
    
    .avatar-group.four-avatars .avatar-item:nth-child(3) {
      left: 70px;
      top: 15.03px;
    }
    
    .avatar-group.four-avatars .avatar-item:nth-child(3) img {
      width: 49px;
      height: 49px;
      transform: rotate(-6deg);
    }
    
    .avatar-group.four-avatars .avatar-item:nth-child(4) {
      left: 106.87px;
      top: 0;
    }
    
    .avatar-group.four-avatars .avatar-item:nth-child(4) img {
      width: 56.5px;
      height: 56.5px;
      transform: rotate(12deg);
    }
    
    .avatar-group.four-avatars .avatar-item img {
      border-radius: 12px;
      object-fit: cover;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
      image-rendering: -webkit-optimize-contrast;
    }
    
    /* 生成中指示器 - 绝对定位，距离卡片底部12px */
    .generating-indicator {
      position: absolute;
      left: 20px;
      bottom: 12px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    /* Loading 图标动画 - 12x12 */
    .loading-icon {
      width: 12px;
      height: 12px;
      position: relative;
      flex-shrink: 0;
    }
    
    .loading-icon::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 10px;
      height: 10px;
      border: 1px solid rgba(0, 0, 0, 0.10);
      border-top-color: #909094;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .generating-text {
      font-size: 14px;
      font-weight: 400;
      color: #909094;
    }
    
    /* 打点动画 */
    .loading-dots {
      display: inline;
      font-size: 14px;
      color: var(--bubble-guest-text-primary);
    }
    
    .loading-dots span {
      animation: dotPulse 1.4s ease-in-out infinite;
      opacity: 0.3;
    }
    
    .loading-dots span:nth-child(1) {
      animation-delay: 0s;
    }
    
    .loading-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .loading-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes dotPulse {
      0%, 60%, 100% {
        opacity: 0.3;
      }
      30% {
        opacity: 1;
      }
    }
    
    /* 底部区域 */
    .bottom-area {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 128px;
      background: var(--bg-nav-bottom-aio);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      z-index: 100;
      border-radius: 0 0 40px 40px;
    }
    
    /* 输入框 */
    .input-box {
      width: 100%;
      height: 58px;
      padding: 8px 16px;
    }
    
    .input-box img {
      height: 42px;
    }
    
    /* 工具栏 */
    .toolbar {
      width: 100%;
      height: 36px;
      display: flex;
      align-items: center;
      padding: 4px 32px;
      gap: 39.2px;
    }
    
    .toolbar-btn {
      width: 28px;
      height: 28px;
      cursor: pointer;
    }
    
    .toolbar-btn img {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="phone-container">
    <!-- 导航头部 -->
    <div class="nav-header" id="navHeader">
      <div class="status-bar">
        <div class="time">9:00</div>
        <div class="icons">
          <img src="assets/CodeBubbyAssets/64_28597/10.svg" alt="signal">
          <img src="assets/CodeBubbyAssets/64_28597/9.svg" alt="wifi">
          <img src="assets/CodeBubbyAssets/64_28597/8.svg" alt="battery">
        </div>
      </div>
      
      <div class="title-bar">
        <img class="back-btn" id="titleBackBtn" src="assets/CodeBubbyAssets/71_29635/11.svg" alt="back">
        <span class="title">雪球设计组 (12)</span>
        <img class="menu-btn" src="assets/CodeBubbyAssets/64_28597/12.svg" alt="menu">
      </div>
      
      <div class="tab-bar" id="tabBar">
        <div class="tab-scroll">
          <div class="tab-item active">Tab 1</div>
          <div class="tab-item">Tab 2</div>
          <div class="tab-item">Tab 3</div>
          <div class="tab-item">Tab 4</div>
          <div class="tab-item">Tab 5</div>
        </div>
        <div class="tab-more">
          <img src="assets/CodeBubbyAssets/64_28597/13.svg" alt="more">
        </div>
      </div>
    </div>
    
    <!-- 过渡容器 -->
    <div class="transition-wrapper with-tab" id="transitionWrapper">
      <!-- 消息区域 -->
      <div class="message-area" id="messageArea">
        <div class="time-tip"><span>上午 10:23</span></div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/14.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">哈哈哈哈哈哈哈软软糯糯呢</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/15.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">其实她在想，这个人怎么还不去上班，整天在这烦我哈哈哈哈哈</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/17.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/16.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/18.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">哈哈哈哈哈哈哈哈哈哈哈哈哈</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/19.svg" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="sticker"><img src="assets/CodeBubbyAssets/64_28597/20.svg" alt="sticker"></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble bubble-with-image">
                <span class="bubble-text">你看这货，刚吐槽完我，转头就把我刚买的猫条叼沙发上啃</span>
                <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/22.png" alt="cat">
              </div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">布偶猫是不是都这 "两面派" 属性啊？</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">哈哈哈哈布偶猫的 "绿茶" 属性是刻在 DNA 里的吧！我家那只更绝 </span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">我加班到半夜，它蹲在门口冲我喵喵叫，看起来委屈得不行，结果我刚把它抱起来，这货直接把爪子搭我肩膀上睡着了，重得跟块小毛毯似的！</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/23.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">对对对！它们是不是算准了自己长得好看，就使劲拿捏人啊？</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">上次我朋友来我家，这猫直接凑过去蹭人家腿，尾巴甩得跟小旗子似的</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/24.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">结果朋友一走，它转头就给我一个 "莫挨老子" 的后脑勺。</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/25.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble-emoji"><img src="assets/CodeBubbyAssets/64_28597/48.png" alt="emoji"></div>
            </div>
          </div>
        </div>
        
        <!-- 高亮消息区域 -->
        <div class="highlight-wrapper" id="highlightWrapper">
          <div class="message guest" id="highlightMsg1">
            <div class="message-wrapper">
              <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
              <div class="message-content">
                <div class="nickname">蛋黄</div>
                <div class="bubble"><span class="bubble-text">布偶猫的颜值是 "免死金牌" 吧！之前吐槽它掉毛掉得沙发上全是 "蒲公英"</span></div>
              </div>
            </div>
          </div>
          
          <div class="message guest" id="highlightMsg2">
            <div class="message-wrapper">
              <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
              <div class="message-content">
                <div class="nickname">蛋黄</div>
                <div class="bubble"><span class="bubble-text">我妈还说 "掉毛怎么了？我们宝宝掉的毛都是仙女绒毛"</span></div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">合着我天天粘毛是我活该呗？</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/26.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/27.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">哈哈哈哈哈哈哈哈哈哈哈哈哈</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble-emoji"><img src="assets/CodeBubbyAssets/64_28597/48.png" alt="emoji"></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">这猫上次把我妈的毛线球扒得满地都是</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">我妈一边捡线一边说 "我们宝宝是在帮我拆快递呢"</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble"><span class="bubble-text">转头就给我发消息让我给猫买新的逗猫棒 — 你说这是不是 "猫德绑架"？</span></div>
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/28.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/29.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">哈哈哈哈哈哈哈哈哈哈哈哈哈</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <div class="bubble"><span class="bubble-text">我懂！我家那只把我杯子碰倒了，水洒了一桌子，它蹲在旁边舔爪子，我刚想凶它，它突然用脑袋蹭我手，我瞬间就软了 — 布偶猫这 "美貌 + 软萌" 的组合，是不是专门用来让人放弃原则的啊？</span></div>
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/30.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message host">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/39.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">杰德</div>
              <img class="bubble-image" src="assets/CodeBubbyAssets/64_28597/31.png" alt="cat">
            </div>
          </div>
        </div>
        
        <div class="message guest">
          <div class="message-wrapper">
            <div class="avatar"><img src="assets/CodeBubbyAssets/64_28597/47.png" alt="avatar"></div>
            <div class="message-content">
              <div class="nickname">蛋黄</div>
              <div class="bubble-emoji"><img src="assets/CodeBubbyAssets/64_28597/48.png" alt="emoji"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- AI 总结内容区域 -->
      <div class="content-area" id="contentArea">
        <div class="summary-card" id="summaryCard1">
          <div class="summary-card-content">
            <div class="summary-date">12-23 </div>
            <div class="summary-text">分享布偶猫的两面派操作，对外粘人撒娇、对内 莫挨老子，靠颜值拿捏主人，连闯祸都能靠软萌表情免罚。</div>
          </div>
          <div class="avatar-group three-avatars">
            <div class="avatar-item"><img src="assets/CodeBubbyAssets/71_29635/优雅的布偶猫，优雅的你～_1_宠物摄影-JC_来自小红书网页版.jpg" alt="avatar"></div>
            <div class="avatar-item"><img src="assets/CodeBubbyAssets/71_29635/优雅的布偶猫，优雅的你～_2_宠物摄影-JC_来自小红书网页版.jpg" alt="avatar"></div>
            <div class="avatar-item"><img src="assets/CodeBubbyAssets/71_29635/优雅的布偶猫，优雅的你～_3_宠物摄影-JC_来自小红书网页版.jpg" alt="avatar"></div>
          </div>
        </div>
        
        <div class="summary-card" id="summaryCard2">
          <div class="summary-card-content">
            <div class="summary-date">12-24 </div>
            <div class="summary-text">布偶猫闯祸时，家人会帮它找借口。主人一边吐槽它掉毛拆家，一边被它的颜值软化，自愿妥协。</div>
          </div>
          <div class="avatar-group four-avatars">
            <div class="avatar-item"><img src="assets/CodeBubbyAssets/71_29635/首先我是一个敏感人，其次才是摄影师_1_林感摄影_来自小红书网页版.jpg" alt="avatar"></div>
            <div class="avatar-item"><img src="assets/CodeBubbyAssets/71_29635/首先我是一个敏感人，其次才是摄影师_3_林感摄影_来自小红书网页版.jpg" alt="avatar"></div>
            <div class="avatar-item"><img src="assets/CodeBubbyAssets/71_29635/首先我是一个敏感人，其次才是摄影师_6_林感摄影_来自小红书网页版.jpg" alt="avatar"></div>
            <div class="avatar-item"><img src="assets/CodeBubbyAssets/71_29635/优雅的布偶猫，优雅的你～_1_宠物摄影-JC_来自小红书网页版.jpg" alt="avatar"></div>
          </div>
        </div>
        
        <div class="summary-card" id="summaryCard3">
          <div class="summary-card-content">
            <div class="summary-date">12-24</div>
            <div class="summary-text">布偶猫粘人时能治愈疲惫，生病时会安静陪伴。主人虽抱怨它挑食，仍主动买冻干讨好，甘愿当猫奴。</div>
          </div>
        </div>
        
        <!-- 第四个卡片 - 生成中状态 -->
        <div class="summary-card generating" id="generatingCard">
          <div class="summary-card-content">
            <div class="summary-date">12-26</div>
            <div class="summary-text">布偶猫会抓坏窗帘搞破坏，但也会化身暖乎乎的小毛毯。它<span class="loading-dots"><span>.</span><span>.</span><span>.</span></span></div>
          </div>
          <div class="generating-indicator">
            <div class="loading-icon"></div>
            <span class="generating-text">生成中</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 底部区域 -->
    <div class="bottom-area">
      <div class="input-box">
        <img src="assets/CodeBubbyAssets/64_28597/1.svg" alt="input">
      </div>
      <div class="toolbar">
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/64_28597/2.svg" alt="voice"></div>
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/64_28597/3.svg" alt="emoji"></div>
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/64_28597/4.svg" alt="image"></div>
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/64_28597/5.svg" alt="plus"></div>
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/64_28597/6.svg" alt="red-packet"></div>
        <div class="toolbar-btn"><img src="assets/CodeBubbyAssets/64_28597/7.svg" alt="more"></div>
      </div>
    </div>
  </div>
  
  <script>
    // 页面状态
    let currentPage = 'chat'; // 'chat' | 'summary'
    let isScrollingToHighlight = false; // 标记是否正在滚动到高亮位置
    
    const phoneContainer = document.querySelector('.phone-container');
    const transitionWrapper = document.getElementById('transitionWrapper');
    const messageArea = document.getElementById('messageArea');
    const contentArea = document.getElementById('contentArea');
    const titleBackBtn = document.getElementById('titleBackBtn');
    const navHeader = document.getElementById('navHeader');
    const tabBar = document.getElementById('tabBar');
    const tabs = document.querySelectorAll('.tab-item');
    const themes = ['theme-tab1', 'theme-tab2', 'theme-tab3', 'theme-tab4', 'theme-tab5'];
    let currentTabIndex = 0;
    
    // 高亮相关元素
    const highlightWrapper = document.getElementById('highlightWrapper');
    const highlightMsg1 = document.getElementById('highlightMsg1');
    const highlightMsg2 = document.getElementById('highlightMsg2');
    const summaryCard1 = document.getElementById('summaryCard1');
    const summaryCard2 = document.getElementById('summaryCard2');
    const summaryCard3 = document.getElementById('summaryCard3');
    
    // 页面加载完成后滚动到底部
    document.addEventListener('DOMContentLoaded', function() {
      messageArea.scrollTop = messageArea.scrollHeight;
    });
    
    // ========== Tab 切换功能 ==========
    function switchToTab(index, direction = null) {
      if (index < 0 || index >= tabs.length || index === currentTabIndex) return;
      
      // 确定滑动方向
      const slideDirection = direction || (index > currentTabIndex ? 'left' : 'right');
      
      // 第一步：滑出动画
      messageArea.classList.add(slideDirection === 'left' ? 'slide-out-left' : 'slide-out-right');
      
      setTimeout(() => {
        // 更新Tab状态
        currentTabIndex = index;
        
        tabs.forEach(t => t.classList.remove('active'));
        tabs[index].classList.add('active');
        
        themes.forEach(theme => phoneContainer.classList.remove(theme));
        phoneContainer.classList.add(themes[index]);
        
        // 第二步：移除滑出动画，设置滑入起始位置（无过渡）
        messageArea.classList.remove('slide-out-left', 'slide-out-right');
        messageArea.classList.add(slideDirection === 'left' ? 'slide-in-right' : 'slide-in-left');
        
        // 强制重绘
        void messageArea.offsetWidth;
        
        // 第三步：移除滑入起始位置，触发滑入动画
        requestAnimationFrame(() => {
          messageArea.classList.remove('slide-in-left', 'slide-in-right');
        });
        
        tabs[index].scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
      }, 150);
    }
    
    // 点击切换 Tab（支持触摸和点击）
    tabs.forEach((tab, index) => {
      let touchMoved = false;
      
      tab.addEventListener('touchstart', function(e) {
        touchMoved = false;
      }, { passive: true });
      
      tab.addEventListener('touchmove', function(e) {
        touchMoved = true;
      }, { passive: true });
      
      tab.addEventListener('touchend', function(e) {
        if (!touchMoved) {
          e.preventDefault();
          switchToTab(index);
        }
      });
      
      tab.addEventListener('click', function(e) {
        // 桌面端点击
        if (!('ontouchstart' in window)) {
          switchToTab(index);
        }
      });
    });
    
    // ========== 双指捏合检测 ==========
    let initialDistance = 0;
    let isPinching = false;
    let currentScale = 1;
    
    function getDistance(touches) {
      const dx = touches[0].clientX - touches[1].clientX;
      const dy = touches[0].clientY - touches[1].clientY;
      return Math.sqrt(dx * dx + dy * dy);
    }
    
    transitionWrapper.addEventListener('touchstart', function(e) {
      if (e.touches.length === 2) {
        initialDistance = getDistance(e.touches);
        isPinching = true;
        currentScale = 1;
        transitionWrapper.classList.add('pinching');
      }
    }, { passive: true });
    
    transitionWrapper.addEventListener('touchmove', function(e) {
      if (e.touches.length === 2 && isPinching) {
        const currentDistance = getDistance(e.touches);
        const scale = currentDistance / initialDistance;
        
        if (currentPage === 'chat' && scale < 1) {
          // 聊天页：缩小进入总结页
          currentScale = Math.max(0.7, scale);
          transitionWrapper.style.transform = `scale(${currentScale})`;
          
          const progress = (1 - currentScale) / 0.3;
          const messageOpacity = Math.max(0, 1 - progress * 2);
          const summaryOpacity = Math.min(1, progress * 2);
          
          messageArea.style.opacity = messageOpacity;
          contentArea.style.opacity = summaryOpacity;
        } else if (currentPage === 'summary' && scale > 1) {
          // 总结页：放大返回聊天页
          currentScale = Math.min(1.4, scale);
          transitionWrapper.style.transform = `scale(${currentScale})`;
          
          const progress = (currentScale - 1) / 0.4;
          const summaryOpacity = Math.max(0, 1 - progress * 2);
          const messageOpacity = Math.min(1, progress * 2);
          
          messageArea.style.opacity = messageOpacity;
          contentArea.style.opacity = summaryOpacity;
        }
      }
    }, { passive: true });
    
    transitionWrapper.addEventListener('touchend', function(e) {
      if (isPinching) {
        isPinching = false;
        transitionWrapper.classList.remove('pinching');
        
        if (currentPage === 'chat') {
          // 聊天页：缩小到一定程度进入总结页
          if (currentScale < 0.85) {
            switchToSummary();
          } else {
            transitionWrapper.style.transform = '';
            messageArea.style.opacity = '';
            contentArea.style.opacity = '';
          }
        } else if (currentPage === 'summary') {
          // 总结页：放大到一定程度返回聊天页
          if (currentScale > 1.15) {
            switchToChat();
          } else {
            transitionWrapper.style.transform = 'scale(1)';
            messageArea.style.opacity = '';
            contentArea.style.opacity = '';
          }
        }
      }
    }, { passive: true });
    
    // 切换到 AI 总结页面
    function switchToSummary() {
      currentPage = 'summary';
      
      messageArea.classList.add('fading');
      contentArea.classList.add('visible');
      messageArea.style.opacity = '';
      contentArea.style.opacity = '';
      
      transitionWrapper.classList.add('expanding');
      transitionWrapper.style.transform = 'scale(1)';
      
      // 滚动到生成中的卡片
      setTimeout(() => {
        const generatingCard = document.getElementById('generatingCard');
        if (generatingCard) {
          generatingCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }, 100);
      
      setTimeout(() => {
        transitionWrapper.classList.remove('expanding');
      }, 600);
    }
    
    // 返回群聊页面
    function switchToChat(options = {}) {
      currentPage = 'chat';
      
      transitionWrapper.classList.add('collapsing');
      transitionWrapper.style.transform = 'scale(1)';
      messageArea.style.opacity = '';
      contentArea.style.opacity = '';
      
      messageArea.classList.remove('fading');
      contentArea.classList.remove('visible');
      
      setTimeout(() => {
        transitionWrapper.classList.remove('collapsing');
        transitionWrapper.style.transform = '';
        
        // 如果需要滚动到高亮位置
        if (options.scrollToHighlight) {
          scrollToHighlightMessages();
        }
      }, 800);
    }
    
    // ========== 话题高亮功能 ==========
    function scrollToHighlightMessages() {
      // 标记正在滚动到高亮位置，暂时禁用滚动收折
      isScrollingToHighlight = true;
      
      // 添加高亮样式
      highlightMsg1.classList.add('highlighted');
      highlightMsg2.classList.add('highlighted');
      
      // 滚动到高亮消息位置
      setTimeout(() => {
        highlightWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // 滚动完成后恢复滚动收折功能
        setTimeout(() => {
          isScrollingToHighlight = false;
        }, 500);
      }, 100);
      
      // 监听滚动，滚动后移除高亮
      let scrollHandler = null;
      let hasScrolled = false;
      
      scrollHandler = function() {
        if (!hasScrolled) {
          hasScrolled = true;
          
          // 延迟一点再移除高亮，让用户看到
          setTimeout(() => {
            highlightWrapper.classList.add('fading');
            
            setTimeout(() => {
              highlightMsg1.classList.remove('highlighted');
              highlightMsg2.classList.remove('highlighted');
              highlightWrapper.classList.remove('fading');
            }, 500);
          }, 500);
          
          messageArea.removeEventListener('scroll', scrollHandler);
        }
      };
      
      // 等待滚动完成后再添加监听
      setTimeout(() => {
        messageArea.addEventListener('scroll', scrollHandler);
      }, 1000);
    }
    
    // ========== 总结卡片点击事件 ==========
    summaryCard1.addEventListener('click', function() {
      switchToChat({ scrollToHighlight: true });
    });
    
    summaryCard2.addEventListener('click', function() {
      switchToChat({ scrollToHighlight: true });
    });
    
    summaryCard3.addEventListener('click', function() {
      switchToChat({ scrollToHighlight: true });
    });
    
    // 标题栏返回按钮点击事件
    titleBackBtn.addEventListener('click', function() {
      if (currentPage === 'summary') {
        switchToChat();
      }
    });
    
    // ========== 左滑切换 Tab ==========
    let touchStartX = 0;
    let touchStartY = 0;
    let isSwiping = false;
    
    messageArea.addEventListener('touchstart', function(e) {
      if (e.touches.length === 1 && currentPage === 'chat') {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        isSwiping = true;
      }
    }, { passive: true });
    
    messageArea.addEventListener('touchmove', function(e) {
      if (!isSwiping || e.touches.length !== 1) return;
      
      const touchCurrentX = e.touches[0].clientX;
      const touchCurrentY = e.touches[0].clientY;
      const deltaX = touchCurrentX - touchStartX;
      const deltaY = touchCurrentY - touchStartY;
      
      if (Math.abs(deltaY) > Math.abs(deltaX)) {
        isSwiping = false;
      }
    }, { passive: true });
    
    messageArea.addEventListener('touchend', function(e) {
      if (!isSwiping || currentPage !== 'chat') return;
      isSwiping = false;
      
      const touchEndX = e.changedTouches[0].clientX;
      const deltaX = touchEndX - touchStartX;
      const threshold = 80;
      
      if (deltaX < -threshold && currentTabIndex < tabs.length - 1) {
        // 左滑，切换到下一个Tab
        switchToTab(currentTabIndex + 1, 'left');
      } else if (deltaX > threshold && currentTabIndex > 0) {
        // 右滑，切换到上一个Tab
        switchToTab(currentTabIndex - 1, 'right');
      }
    }, { passive: true });
    
    // ========== Tab 栏滚动收折 ==========
    (function() {
      let lastScrollTop = 0;
      let isCollapsed = false;
      
      function handleScroll(scrollArea) {
        // 如果正在滚动到高亮位置，不触发收折
        if (isScrollingToHighlight) return;
        
        const currentScrollTop = scrollArea.scrollTop;
        const scrollDelta = currentScrollTop - lastScrollTop;
        
        if (scrollDelta > 10 && !isCollapsed && currentScrollTop > 50) {
          isCollapsed = true;
          navHeader.classList.add('collapsed');
          tabBar.classList.add('collapsed');
          transitionWrapper.classList.remove('with-tab');
        } else if (scrollDelta < -10 && isCollapsed) {
          isCollapsed = false;
          navHeader.classList.remove('collapsed');
          tabBar.classList.remove('collapsed');
          transitionWrapper.classList.add('with-tab');
        }
        
        lastScrollTop = currentScrollTop;
      }
      
      messageArea.addEventListener('scroll', function() {
        if (currentPage === 'chat') {
          handleScroll(messageArea);
        }
      });
      
      contentArea.addEventListener('scroll', function() {
        if (currentPage === 'summary') {
          handleScroll(contentArea);
        }
      });
    })();
  </script>
</body>
</html>
